# Role: Senior EdTech Architect & Fintech Developer

## Project Context: Vertex OhPro v2 (Final Phase - Teacher Marketplace & Wallet)
The operational core is finished. Now, we will transform the platform into a "Teacher-to-Teacher" (T2T) economy. The goal is to allow teachers to monetize their universal lesson plans and library resources, creating a new revenue stream for them and the platform.

## Tech Stack & Standards
- **Framework:** Laravel 12 + Livewire 3 + Tailwind CSS v4.1.
- **Financials:** Stripe Connect or Mercado Pago Split logic.
- **Icons:** FontAwesome Pro Duotone (`fa-duotone`).
- **Audit:** All financial transactions must be recorded via the `Auditable` trait.
- **Design Philosophy:** Teacher-centric. Everything belongs to the teacher.

---

## Task 1: Module Marketplace - The T2T Store
Enable teachers to discover and purchase high-quality pedagogical materials.
- **Feature:** A storefront inside the platform to browse "Premium Plans" and "Library Packs".
- **Product Flow:** Allow a teacher to select a `LessonPlan` (from Planning module) or a folder (from Library) and "Publish to Marketplace".
- **Pricing:** The teacher sets the price. The system calculates the platform fee (e.g., 20%).
- **UI:** A modern, grid-based store with "Previews" generated by the Browsershot engine.

## Task 2: Module Finance - Teacher Wallet System
A dedicated space for the teacher to track their earnings.
- **The Wallet:** Create a `wallets` table linked to the `User`.
- **Ledger:** Track balances from:
    1. Marketplace Sales.
    2. Referral Rewards (from the Phase 10 Referral System).
- **Withdrawal Flow:** A simple interface for the teacher to request a payout once they reach a minimum balance.
- **Icons:** `fa-duotone fa-wallet` and `fa-duotone fa-money-check-dollar-pen`.

## Task 3: Secure Digital Delivery
- **Logic:** When a material is purchased, the system must automatically "Clone" the material (using the existing `cloneFrom` logic in LessonPlanService) into the buyer's private account.
- **Permissions:** Buyers have "Edit" access to their copy, but cannot redistribute it on the marketplace.
- **Anti-Piracy:** Add a subtle PDF watermark to sold materials containing the Buyer's name/ID.

## Task 4: Personal Portfolio 2.0 (Public Teacher Profile)
The teacher as a Brand.
- **Public Profile:** A public-facing URL (e.g., `/pro/username`) showing the teacher's bio, their marketplace materials, and verified stats (e.g., "500+ students taught").
- **Hire Me Button:** A simple WhatsApp contact button for schools interested in hiring the teacher based on their public performance.
- **UI:** Use the glassmorphism style and the teacher's custom logo/branding.

---

## Technical Constraints
- **Database:** Create `orders`, `order_items`, and `transactions` tables.
- **Security:** Ensure that only the Buyer has access to the purchased Library files (S3 signed URLs recommended).
- **Feedback:** Use the global Toast system for "Material Published!" and "Sale Confirmed!" notifications.

---
**Next Step: Start by creating the Marketplace infrastructure (Models and Controllers) and the Wallet system.**

## Apois concluir a fase acima é a fase abaixo
# Role: Senior Fullstack Architect & Fintech Developer (Laravel 12 Expert)

## Project Context: Vertex OhPro v2 (Phase 11 - Marketplace & Financial Engine)
We are implementing the "Grand Finale" of the teacher's independence: the **Pedagogical Marketplace**.
This allows teachers to list their Universal Lesson Plans and Library Resources for sale. The system will handle split payments, commissions, and a virtual wallet for the teacher.

## Tech Stack & Standards
- **Framework:** Laravel 12 + Livewire 3 + Tailwind CSS v4.1.
- **Iconography:** FontAwesome Pro Duotone (`fa-duotone`).
- **Standards:** Strictly follow `GlobalSystem.md` for UI components and `Auditable` trait for all financial records.

---

## Task 1: Database Infrastructure (The Financial Core)
Generate the following migrations and models to support the marketplace:

### 1.1 Marketplace Items (`marketplace_items`)
- **Fields:** `id`, `user_id` (seller), `lesson_plan_id` (nullable), `library_file_id` (nullable), `title`, `description`, `price` (decimal), `status` (draft/published), `preview_path` (for Browsershot previews), `sales_count`.
- **Logic:** Link pedagogical resources to a saleable product.

### 1.2 Teacher Wallet (`wallets`)
- **Fields:** `id`, `user_id`, `balance` (decimal), `withdrawable_balance` (decimal), `currency` (default BRL).
- **Model:** Ensure `belongsTo(User)`.

### 1.3 Orders & Items (`orders`, `order_items`)
- **Orders:** `buyer_id`, `total_amount`, `status` (pending/completed/failed), `gateway_id` (Stripe/MP).
- **Items:** `order_id`, `marketplace_item_id`, `price_at_sale`, `platform_fee` (e.g., 20%).

### 1.4 Ledger Transactions (`transactions`)
- **Fields:** `wallet_id`, `amount`, `type` (sale, withdrawal, platform_fee, referral_bonus), `description`, `metadata` (JSON).
- **Logic:** This is the history of every cent that enters or leaves the teacher's wallet.

---

## Task 2: Marketplace Publication Flow
- **Feature:** In the `Planning` and `Library` modules, add a "Vender na Loja" button.
- **Component:** A Livewire wizard to set the price and description before creating the `MarketplaceItem`.
- **Preview Generation:** Use the existing `PdfReportService` logic (Browsershot) to generate a blurred "blurred image preview" of the first page of the material to show in the store.

## Task 3: Wallet Dashboard (Module: Teacher)
- **UI:** A beautiful financial card on the Dashboard using glassmorphism.
- **Display:** "Saldo Disponível", "Vendas do Mês", and "Histórico de Transações".
- **Action:** A "Solicitar Saque" button that triggers a Support Ticket for the Admin to process the payment.
- **Icons:** `fa-duotone fa-wallet`, `fa-duotone fa-money-bill-transfer`.

## Task 4: Secure Purchase & Delivery Logic
- **Logic:** Upon successful payment callback (Webhook), the system must:
    1. Create a `Transaction` (Credit for Seller, Debit/Log for Platform).
    2. Update the Seller's `Wallet`.
    3. Trigger the `LessonPlanService@cloneFrom` to create a copy of the material for the Buyer.
- **Notification:** Notify both parties via the `NotificationCenter`.

---

## Technical Constraints
- **Data Integrity:** All wallet balance updates MUST happen within a `DB::transaction()`.
- **Security:** Only the Seller can edit their marketplace listing. Only the Buyer can access the purchased copy.
- **Branding:** Ensure all marketplace views use the Poppins/Inter typography from `GlobalSystem.md`.

---
**Next Step: Start by generating the 4 financial migrations and their corresponding Models with relationships.**